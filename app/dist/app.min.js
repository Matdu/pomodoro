!function(){"use strict";angular.module("pomodoro",[])}(),function(){"use strict";function t(t,o,i,e){var n=this;n.states={started:!1,paused:!0,btn:"paused",background:"active",settings:!1,allowNotifactions:!1},n.models={desktopNotification:e.getNotification("desktop"),audioNotifications:e.getNotification("audio"),activeTime:e.getTime("active"),shortBreak:e.getTime("shortBreak"),longBreak:e.getTime("longBreak"),count:0},n.init=function(){n.pomodoro=new t(function(t){n.setTime(t)}),n.time=i.parse(n.pomodoro.getDuration()),n.states.allowNotifactions=n.pomodoro.noticaftions(),n.timerState=n.setBtn(),n.pomodoro.allowNotifaction(n.models.desktopNotification)},n.isPaused=function(){return"paused"===n.states.btn},n.setTime=function(t){n.time=i.parse(t),o.$apply()},n.toggleTimer=function(){n.states.started?n.pomodoro.isPaused()?(n.states.paused=!1,n.closeSettings(),n.pomodoro.resume()):(n.states.paused=!0,n.pomodoro.pause()):(n.states.started=!0,n.states.paused=!1,n.closeSettings(),n.pomodoro.start()),n.timerState=n.setBtn()},n.setBtn=function(){return n.states.started?n.states.paused?"resume":"pause":"start"},n.toggleSettings=function(){n.states.settings=!n.states.settings},n.closeSettings=function(){n.states.settings=!1},n.allowDesktopNotifications=function(){n.pomodoro._notifier.grantPermission(),e.setNotification("desktop",n.models.desktopNotification),n.pomodoro.allowNotifaction(n.models.desktopNotification)},n.toggleAudioNotifications=function(){e.setNotification("audio",n.models.audioNotifications),n.pomodoro._audioNotification=n.models.audioNotifications},n.reset=function(){n.pomodoro.reset(),n.time=i.parse(n.pomodoro.getDuration())},n.updateTime=function(t,o){e.setTime(t,o)},o.$on("typeChange",function(t,o){n.states.background=o.type,n.models.count=n.pomodoro._count})}angular.module("pomodoro").controller("MainCtrl",t),t.$inject=["Pomodoro","$scope","TimeParser","TimerSettings"]}(),function(){"use strict";function t(t,o){function i(t){this.settings=t||{},this.permission=!1,this._notifaction=null,this._audio=new Audio(e.sound)}var e={title:"Pomodoro",tag:"pomodoro",dismiss:3e3,sound:"./assets/alarm.mp3"};return i.prototype.isSupported=function(){return"Notification"in t},i.prototype.grantPermission=function(){var t=this;Notification.requestPermission(function(o){t.permission="granted"===o})},i.prototype.setNotifaction=function(t){function i(){n._audio.pause(),n._audio.currentTime=0}var n=this,s=this._notifaction=new Notification(e.title,{body:t,tag:e.tag});this._notifaction.onshow=function(){o(s.close.bind(s),e.dismiss)},this._notifaction.onclose=i,this._notifaction.onclick=i},i.prototype.playSound=function(){this._audio.play()},i.prototype.getPermission=function(){return this.permission},i}angular.module("pomodoro").factory("Notifier",t),t.$inject=["$window","$timeout"]}(),function(){"use strict";function t(t,o,i,e){function n(t){this._callback=t,this._duration=e.getTime("active"),this._count=0,this._isBreak=!1,this._timer=null,this._isPaused=!0,this._notifier=new i,this._desktopNotification=!1,this._audioNotification=!1,this._state="active"}var s;return n.prototype.complete=function(){var t;this._isBreak||this._count++,this._desktopNotification&&this.setDesktopNotification(),this._audioNotification&&this._notifier.playSound(),t=this._isBreak?"active":"break",o.$broadcast("typeChange",{type:t}),this._isBreak=!this._isBreak,this.cancelTimer(),this.start()},n.prototype.start=function(){this._timer||(this._timer=!0,this._isBreak&&this._count%4===0?(s="break",this._state="longBreak"):this._isBreak&&this._count%4!==0?(s="break",this._state="shortBreak"):(s="active",this._state="active"),this.run())},n.prototype.reset=function(){this.cancelTimer(),this.run()},n.prototype.pause=function(){this.cancelTimer()},n.prototype.cancelTimer=function(){this._isPaused=!0,t.clearTimer(),this._timer=!1},n.prototype.resume=function(){this._isPaused=!1,t.startTimer({callback:this._callback,self:this})},n.prototype.run=function(){this._duration=e.getTime(this._state),this._isPaused=!1,t.startTimer({time:this._duration,callback:this._callback,self:this})},n.prototype.getDuration=function(){return e.getTime(this._state)},n.prototype.isPaused=function(){return this._isPaused},n.prototype.noticaftions=function(){return this._notifier.isSupported()},n.prototype.allowNotifaction=function(t){this._desktopNotification=t},n.prototype.setDesktopNotification=function(){this._notifier.setNotifaction(this._isBreak?e.getMsg("active"):this._count%4===0?e.getMsg("longBreak"):e.getMsg("shortBreak"))},n}angular.module("pomodoro").factory("Pomodoro",t),t.$inject=["Timer","$rootScope","Notifier","TimerSettings"]}(),function(){"use strict";function t(t){function o(o){t.bind("keydown",function(t){t.keyCode===i&&(o.listener(),o.$apply())})}var i=32;return{restrict:"A",scope:{listener:"&"},link:o}}angular.module("pomodoro").directive("spacebarListener",t),t.$inject=["$document"]}(),function(){"use strict";function t(){return{restrict:"E",scope:{notification:"=",change:"&",label:"@",klass:"@"},template:['<div class="toggle__container {{klass}}">','<p class="toggle__label">{{label}}</p>','<div class="toggle">','<input type="checkbox" class="toggle__checkbox" ng-model="notification" ng-click="change()">','<b class="toggle__switch"></b>','<b class="toggle__track"></b>',"</div>","</div>"].join("")}}angular.module("pomodoro").directive("toggle",t)}(),function(){"use strict";function t(t){function o(o,i){t.localStorage.setItem(o,i)}function i(o){return t.localStorage.getItem(o)}return{set:o,get:i}}angular.module("pomodoro").service("Storage",t),t.$inject=["$window"]}(),function(){"use strict";function t(){var t={};return t.parse=function(t){if(isNaN(t))return"";var i,e;return i=o(Math.floor(t/60)),e=o(t-60*i),i+" : "+e},t}function o(t){return 10>t?"0"+t:t}angular.module("pomodoro").service("TimeParser",t)}(),function(){"use strict";function t(){var t={},o=new Worker("./js/timer-worker.js"),i=!1;return t.startTimer=function(t){o.postMessage({command:"start",time:t.time}),o.onmessage=function(o){if(o.data.started)return i=o.data.started;switch(o.data.message){case"tick":t.callback.call(this,o.data.time);break;case"complete":t.self.complete.call(t.self)}}},t.clearTimer=function(){i&&(o.postMessage({command:"clear"}),o.onmessage=function(t){i=!t.data.cleared})},t.isActive=function(){return i},t}angular.module("pomodoro").service("Timer",t)}(),function(){"use strict";function t(t,o){function i(t,o){r[t]=Number(60*o)}function e(t){return r[t]||0}function n(t){var o=r[t];return"active"!==t?"enjoy a "+o+" min break":"keep up the good work, only "+o+" mins till your next break"}function s(t,i){o.set(t,i)}function a(t){return"true"===o.get(t)||!1}var r={shortBreak:10,longBreak:15,active:3};return{setTime:i,getTime:e,getMsg:n,setNotification:s,getNotification:a}}angular.module("pomodoro").service("TimerSettings",t),t.$inject=["$window","Storage"]}();